<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NPS</title>

  <meta name="apple-mobile-web-app-capable" content="yes">

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #000;
    }

    .screen {
      display: none;
      min-height: 100vh;
      padding: 24px;
      box-sizing: border-box;
    }

    .screen.active {
      display: block;
    }

    /* ===== FIRST SCREEN BACKGROUND ===== */
    #step1 {
      position: relative;
      background: url("bg.jpg") center / cover no-repeat;
    }

    #step1::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.55);
      z-index: 0;
    }

    #step1 > * {
      position: relative;
      z-index: 1;
    }

    h2 {
      text-align: center;
      color: #fff;
      margin-bottom: 6px;
    }

    .subtitle {
      text-align: center;
      color: rgba(255,255,255,0.85);
      font-size: 14px;
      margin-bottom: 16px;
    }

    /* ADMIN BUTTON */
    .admin-btn {
      display: block;
      margin: 0 auto 16px;
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 20px;
      border: none;
      background: rgba(255,255,255,0.15);
      color: #fff;
    }

    /* ===== EMPLOYEES GRID (MAX 4 PER ROW) ===== */
    .employees {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      .employees { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 600px) {
      .employees { grid-template-columns: repeat(2, 1fr); }
    }

    .employee {
      text-align: center;
      color: #fff;
      user-select: none;
    }

    .employee:active {
      transform: scale(0.96);
    }

    .avatar {
      aspect-ratio: 1 / 1;
      border-radius: 24%;
      overflow: hidden;
      background: #fff;
      box-shadow:
        0 10px 25px rgba(0,0,0,0.4),
        0 0 0 2px rgba(255,255,255,0.15);
      margin-bottom: 6px;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .name {
      font-size: 15px;
      font-weight: 500;
    }

    /* ===== RATING ===== */
    .rating {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
    }

    button {
      padding: 16px;
      font-size: 18px;
      border-radius: 12px;
      border: none;
      background: #fff;
    }

    textarea {
      width: 100%;
      height: 120px;
      border-radius: 12px;
      padding: 12px;
      font-size: 16px;
      resize: none;
      margin-bottom: 12px;
    }

    .send {
      width: 100%;
      background: #007aff;
      color: #fff;
    }

    /* ===== ADMIN ===== */
    .admin-list label {
      display: block;
      padding: 10px 0;
      font-size: 18px;
    }

    .back {
      margin-top: 16px;
      background: #ddd;
    }
  </style>
</head>

<body>

<!-- STEP 1 -->
<div id="step1" class="screen active">
  <h2>–ö—Ç–æ –≤–∞–º –ø–æ–º–æ–≥–∞–ª?</h2>
  <div class="subtitle">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</div>
  <button class="admin-btn" onclick="openAdmin()">‚öôÔ∏è –°–º–µ–Ω–∞</button>
  <div class="employees" id="employees"></div>
</div>

<!-- STEP 2 -->
<div id="step2" class="screen">
  <h2>–û—Ü–µ–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É</h2>
  <div class="rating" id="rating"></div>
</div>

<!-- STEP 3 -->
<div id="step3" class="screen">
  <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h2>
  <textarea id="comment" placeholder="–í–∞—à –æ—Ç–∑—ã–≤"></textarea>
  <button class="send" onclick="send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>

<!-- THANK YOU -->
<div id="thanks" class="screen">
  <h2>–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤ üôè</h2>
</div>

<!-- ADMIN -->
<div id="admin" class="screen">
  <h2>–ö—Ç–æ —Å–µ–≥–æ–¥–Ω—è –≤ —Å–º–µ–Ω–µ</h2>
  <div class="admin-list" id="adminList"></div>
  <button onclick="saveToday()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  <button class="back" onclick="show('step1')">–ù–∞–∑–∞–¥</button>
</div>

<script>
/* ===== CONFIG ===== */
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbzDLkPTd4Etrgj1a7odkFgJa-cN8pS4vsBfof9nTih6bGlvIGHZmosmDKIEg_xYKhSW/exec";

/* ===== EMPLOYEES ===== */
const allEmployees = [
  { name: "–≠—Ñ–µ–Ω–¥–∏", photo: "efendi.jpg" },
  { name: "–ò–≤–∞–Ω", photo: "ivan.jpg" },
  { name: "–ú–∞—Ä–∏—è", photo: "masha.jpg" },
  { name: "–ê–Ω–¥—Ä–µ–π", photo: "andrey.jpg" },
  { name: "–Ø—Ä–æ—Å–ª–∞–≤", photo: "yaroslav.jpg" },
  { name: "–í–ª–∞–¥–∏—Å–ª–∞–≤", photo: "vladislav.jpg" },
  { name: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞", photo: "ekaterina.jpg" },
  { name: "–¢–æ—Ñ–∏–∫", photo: "tofik.jpg" },
  { name: "–ê—Ä—Ç—ë–º", photo: "artem.jpg" },
  { name: "–ú–∏—Ö–∞–∏–ª", photo: "misha.jpg" },
  { name: "–¢–∞–º—Ä–∏–∫–æ", photo: "tamriko.jpg" },
  { name: "–†–æ–∑–∞", photo: "roza.jpg" },
  { name: "–ò–ª—å–¥–∞—Ä", photo: "ildar.jpg" }
];

/* ===== STATE ===== */
let todayEmployees =
  JSON.parse(localStorage.getItem("todayEmployees")) || allEmployees;

let employee = "";
let score = 0;

/* ===== HELPERS ===== */
function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ===== RENDER EMPLOYEES ===== */
function renderEmployees() {
  const wrap = document.getElementById("employees");
  wrap.innerHTML = "";
  todayEmployees.forEach(e => {
    const el = document.createElement("div");
    el.className = "employee";
    el.onclick = () => selectEmployee(e.name);
    el.innerHTML = `
      <div class="avatar"><img src="${e.photo}"></div>
      <div class="name">${e.name}</div>
    `;
    wrap.appendChild(el);
  });
}

/* ===== RATING ===== */
const rating = document.getElementById("rating");
for (let i = 1; i <= 10; i++) {
  const b = document.createElement("button");
  b.textContent = i;
  b.onclick = () => { score = i; show("step3"); };
  rating.appendChild(b);
}

/* ===== FLOW ===== */
function selectEmployee(name) {
  employee = name;
  show("step2");
}

function send() {
  fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    body: JSON.stringify({
      employee,
      score,
      comment: comment.value
    })
  });
  show("thanks");
  setTimeout(() => location.reload(), 3000);
}

/* ===== ADMIN ===== */
function openAdmin() {
  show("admin");
  const list = document.getElementById("adminList");
  list.innerHTML = "";
  allEmployees.forEach(e => {
    const checked = todayEmployees.some(t => t.name === e.name);
    list.innerHTML += `
      <label>
        <input type="checkbox" ${checked ? "checked" : ""} value="${e.name}">
        ${e.name}
      </label>
    `;
  });
}

function saveToday() {
  const checked = [...document.querySelectorAll("#adminList input:checked")]
    .map(i => i.value);

  todayEmployees = allEmployees.filter(e => checked.includes(e.name));
  localStorage.setItem("todayEmployees", JSON.stringify(todayEmployees));
  show("step1");
  renderEmployees();
}

/* INIT */
renderEmployees();
</script>

</body>
</html>
