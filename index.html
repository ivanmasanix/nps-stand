<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NPS</title>
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #000;
}

.screen {
  display: none;
  min-height: 100vh;
  padding: 24px;
  box-sizing: border-box;
  position: relative;
}

.screen.active { display: block; }

/* BACK */
.back-top {
  position: absolute;
  top: 16px;
  left: 16px;
  background: rgba(255,255,255,0.25);
  border: none;
  color: #fff;
  font-size: 18px;
  padding: 6px 10px;
  border-radius: 10px;
  opacity: .6;
}

/* STEP 1 */
#step1 {
  background: url("bg.jpg") center / cover no-repeat;
}

#step1::before {
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.55);
}

#step1 > * { position:relative; z-index:1; }

h2 {
  text-align:center;
  color:#fff;
  margin-bottom:8px;
}

.subtitle {
  text-align:center;
  color:rgba(255,255,255,.85);
  font-size:14px;
  margin-bottom:20px;
}

/* EMPLOYEES */
.employees {
  display:grid;
  grid-template-columns:repeat(4,120px);
  gap:20px;
  justify-content:center;
}

.employee {
  text-align:center;
  color:#fff;
}
.employee:active { transform:scale(.96); }

.avatar {
  width:120px;
  height:120px;
  border-radius:22%;
  overflow:hidden;
  background:#fff;
  box-shadow:0 6px 16px rgba(0,0,0,.35);
  margin-bottom:6px;
}

.avatar img {
  width:100%;
  height:100%;
  object-fit:cover;
}

.name { font-size:13px; }

.admin-btn {
  display:block;
  margin:28px auto 0;
  padding:8px 16px;
  font-size:14px;
  border-radius:20px;
  border:none;
  background:rgba(255,255,255,.18);
  color:#fff;
}

/* STEP 2 */
.rating {
  display:grid;
  grid-template-columns:repeat(5,120px);
  gap:20px;
  justify-content:center;
  margin-top:24px;
}

.rating-item {
  width:120px;
  height:120px;
  border-radius:22%;
  overflow:hidden;
  box-shadow:0 6px 16px rgba(0,0,0,.35);
}

.rating-item img {
  width:100%;
  height:100%;
  object-fit:cover;
}

textarea, input {
  width:100%;
  border-radius:12px;
  padding:12px;
  font-size:16px;
  margin-top:16px;
  box-sizing:border-box;
}

textarea {
  height:100px;
  resize:none;
}

.send {
  width:100%;
  margin-top:20px;
  padding:16px;
  font-size:18px;
  border-radius:12px;
  border:none;
  background:#007aff;
  color:#fff;
}

/* SOURCES */
.sources {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  margin-top:20px;
}

.source-btn {
  padding:14px;
  border-radius:12px;
  border:none;
  background:rgba(255,255,255,.85);
  font-size:15px;
}

.source-btn.active {
  background:#007aff;
  color:#fff;
}

/* ADMIN */
.admin-list {
  display:grid;
  grid-template-columns:repeat(2, minmax(220px, 1fr));
  gap:16px 32px;
  max-width:520px;
  margin:24px auto;
}

.admin-list label {
  display:flex;
  align-items:center;
  gap:12px;
  font-size:18px;
  color:#fff;
}

.admin-list input {
  width:20px;
  height:20px;
}
</style>
</head>

<body>

<!-- STEP 1 -->
<div id="step1" class="screen active">
  <h2>–ö—Ç–æ –∏–∑ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –í–∞–º –ø–æ–º–æ–≥–∞–ª?</h2>
  <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –Ω–∏–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞</div>
  <div class="employees" id="employees"></div>
  <button class="admin-btn" onclick="openAdmin()">‚öôÔ∏è –°–º–µ–Ω–∞</button>
</div>

<!-- STEP 2 -->
<div id="step2" class="screen">
  <button class="back-top" onclick="show('step1')">‚Üê</button>
  <h2 id="ratingTitle">–û—Ü–µ–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É</h2>
  <div class="rating" id="rating"></div>
  <textarea id="comment" placeholder="–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
  <button class="send" onclick="goStep3()">–î–∞–ª–µ–µ</button>
</div>

<!-- STEP 3 -->
<div id="step3" class="screen">
  <button class="back-top" onclick="show('step2')">‚Üê</button>
  <h2>–û—Ç–∫—É–¥–∞ –≤—ã –æ –Ω–∞—Å —É–∑–Ω–∞–ª–∏?</h2>

  <div class="sources">
    <button class="source-btn" onclick="selectSource(this,'–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏')">–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</button>
    <button class="source-btn" onclick="selectSource(this,'–ü—Ä–æ—Ö–æ–¥–∏–ª–∏ –º–∏–º–æ')">–ü—Ä–æ—Ö–æ–¥–∏–ª–∏ –º–∏–º–æ</button>
    <button class="source-btn" onclick="selectSource(this,'–û—Ç –¥—Ä—É–∑–µ–π')">–û—Ç –¥—Ä—É–∑–µ–π</button>
    <button class="source-btn" onclick="selectSource(this,'–£–∂–µ —è–≤–ª—è—é—Å—å –≤–∞—à–∏–º –∫–ª–∏–µ–Ω—Ç–æ–º')">
      –£–∂–µ —è–≤–ª—è—é—Å—å –≤–∞—à–∏–º –∫–ª–∏–µ–Ω—Ç–æ–º
    </button>
  </div>

  <input id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
  <button class="send" onclick="send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>

<!-- THANKS -->
<div id="thanks" class="screen">
  <h2>–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤ üôè</h2>
</div>

<!-- ADMIN -->
<div id="admin" class="screen">
  <button class="back-top" onclick="show('step1')">‚Üê</button>
  <h2>–ö—Ç–æ —Å–µ–≥–æ–¥–Ω—è –≤ —Å–º–µ–Ω–µ</h2>
  <div class="admin-list" id="adminList"></div>
  <button class="admin-btn" onclick="saveToday()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyanSi5CSp3VLjNRrp4gcWucI_KdwQwMIypBnU_oPaiFc_i_FcFrKjfTeS4Ia-U6zD5/exec";

const nameGenitive = {
  "–≠—Ñ–µ–Ω–¥–∏":"–≠—Ñ–µ–Ω–¥–∏","–ò–≤–∞–Ω":"–ò–≤–∞–Ω–∞","–ú–∞—Ä–∏—è":"–ú–∞—Ä–∏–∏","–ê–Ω–¥—Ä–µ–π":"–ê–Ω–¥—Ä–µ—è",
  "–Ø—Ä–æ—Å–ª–∞–≤":"–Ø—Ä–æ—Å–ª–∞–≤–∞","–í–ª–∞–¥–∏—Å–ª–∞–≤":"–í–ª–∞–¥–∏—Å–ª–∞–≤–∞","–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞":"–ï–∫–∞—Ç–µ—Ä–∏–Ω—ã",
  "–¢–æ—Ñ–∏–∫":"–¢–æ—Ñ–∏–∫–∞","–ê—Ä—Ç—ë–º":"–ê—Ä—Ç—ë–º–∞","–ú–∏—Ö–∞–∏–ª":"–ú–∏—Ö–∞–∏–ª–∞",
  "–¢–∞–º—Ä–∏–∫–æ":"–¢–∞–º—Ä–∏–∫–æ","–†–æ–∑–∞":"–†–æ–∑—ã","–ò–ª—å–¥–∞—Ä":"–ò–ª—å–¥–∞—Ä–∞"
};

const allEmployees = [
  { name:"–≠—Ñ–µ–Ω–¥–∏", photo:"efendi.jpg" },
  { name:"–ò–≤–∞–Ω", photo:"ivan.jpg" },
  { name:"–ú–∞—Ä–∏—è", photo:"masha.jpg" },
  { name:"–ê–Ω–¥—Ä–µ–π", photo:"andrey.jpg" },
  { name:"–Ø—Ä–æ—Å–ª–∞–≤", photo:"yaroslav.jpg" },
  { name:"–í–ª–∞–¥–∏—Å–ª–∞–≤", photo:"vladislav.jpg" },
  { name:"–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞", photo:"ekaterina.jpg" },
  { name:"–¢–æ—Ñ–∏–∫", photo:"tofik.jpg" },
  { name:"–ê—Ä—Ç—ë–º", photo:"artem.jpg" },
  { name:"–ú–∏—Ö–∞–∏–ª", photo:"misha.jpg" },
  { name:"–¢–∞–º—Ä–∏–∫–æ", photo:"tamriko.jpg" },
  { name:"–†–æ–∑–∞", photo:"roza.jpg" },
  { name:"–ò–ª—å–¥–∞—Ä", photo:"ildar.jpg" }
];

let todayEmployees =
  JSON.parse(localStorage.getItem("todayEmployees")) || allEmployees;

let employee = null;
let score = 0;
let source = "";

function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function renderEmployees() {
  const wrap = document.getElementById("employees");
  wrap.innerHTML = "";
  todayEmployees.forEach(e => {
    wrap.innerHTML += `
      <div class="employee" onclick='selectEmployee(${JSON.stringify(e)})'>
        <div class="avatar"><img src="${e.photo}"></div>
        <div class="name">${e.name}</div>
      </div>`;
  });
}

/* ADMIN */
function openAdmin() {
  show("admin");
  const list = document.getElementById("adminList");
  list.innerHTML = "";
  allEmployees.forEach(e => {
    const checked = todayEmployees.some(t => t.name === e.name);
    list.innerHTML += `
      <label>
        <input type="checkbox" value="${e.name}" ${checked ? "checked" : ""}>
        ${e.name}
      </label>`;
  });
}

function saveToday() {
  const selected = [...document.querySelectorAll("#adminList input:checked")]
    .map(i => i.value);
  todayEmployees = allEmployees.filter(e => selected.includes(e.name));
  localStorage.setItem("todayEmployees", JSON.stringify(todayEmployees));
  show("step1");
  renderEmployees();
}

/* FLOW */
function selectEmployee(e) {
  employee = e;
  document.getElementById("ratingTitle").textContent =
    "–û—Ü–µ–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É " + (nameGenitive[e.name] || e.name);
  renderRating();
  show("step2");
}

function renderRating() {
  const wrap = document.getElementById("rating");
  wrap.innerHTML = "";
  for (let i = 1; i <= 10; i++) {
    wrap.innerHTML += `
      <div class="rating-item" onclick="score=${i}">
        <img src="Peak${i}.jpg">
      </div>`;
  }
}

function goStep3() {
  if (!score) return;
  show("step3");
}

function selectSource(btn, val) {
  document.querySelectorAll(".source-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  source = val;
}

function send() {
  fetch(SCRIPT_URL, {
    method:"POST",
    mode:"no-cors",
    body: JSON.stringify({
      employee: employee.name,
      score,
      comment: comment.value,
      source,
      phone: phone.value
    })
  });

  show("thanks");
  setTimeout(() => location.reload(), 3000);
}

renderEmployees();
</script>

</body>
</html>
