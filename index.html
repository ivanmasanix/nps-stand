<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NPS</title>
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #000;
}

.screen {
  display: none;
  min-height: 100vh;
  padding: 24px;
  box-sizing: border-box;
  position: relative;
}

.screen.active { display: block; }

/* BACK */
.back-top {
  position: absolute;
  top: 16px;
  left: 16px;
  background: rgba(255,255,255,0.25);
  border: none;
  color: #fff;
  font-size: 18px;
  padding: 6px 10px;
  border-radius: 10px;
  opacity: .6;
}

/* STEP 1 */
#step1 {
  background: url("bg.jpg") center / cover no-repeat;
}
#step1::before {
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.55);
}
#step1 > * { position:relative; z-index:1; }

h2 {
  text-align:center;
  color:#fff;
  margin-bottom:8px;
}

.subtitle {
  text-align:center;
  color:rgba(255,255,255,.85);
  font-size:14px;
  margin-bottom:20px;
}

/* EMPLOYEES */
.employees {
  display:grid;
  grid-template-columns:repeat(4,120px);
  gap:20px;
  justify-content:center;
}

.employee { text-align:center; color:#fff; }
.employee:active { transform:scale(.96); }

.avatar {
  width:120px;
  height:120px;
  border-radius:22%;
  overflow:hidden;
  background:#fff;
  box-shadow:0 6px 16px rgba(0,0,0,.35);
  margin-bottom:6px;
}

.avatar img {
  width:100%;
  height:100%;
  object-fit:cover;
  pointer-events:none;
}

.name { font-size:13px; }

.admin-btn {
  display:block;
  margin:28px auto 0;
  padding:8px 16px;
  font-size:14px;
  border-radius:20px;
  border:none;
  background:rgba(255,255,255,.18);
  color:#fff;
}

/* STEP 2 – RATING */
.rating {
  display:grid;
  grid-template-columns:repeat(5,120px);
  gap:20px;
  justify-content:center;
  margin-top:24px;
}

.rating-item {
  width:120px;
  height:120px;
  border-radius:22%;
  overflow:hidden;
  box-shadow:0 6px 16px rgba(0,0,0,.35);
  position:relative;
  transition:.15s;
  touch-action: manipulation;
}

.rating-item::after {
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.4);
  opacity:0;
  transition:.15s;
}

.rating-item.selected::after { opacity:1; }
.rating-item.selected { transform:scale(.96); }

.rating-item img {
  width:100%;
  height:100%;
  object-fit:cover;
  pointer-events:none;
}

/* INPUTS */
textarea, input {
  width:100%;
  border-radius:14px;
  padding:14px;
  font-size:16px;
  margin-top:16px;
  box-sizing:border-box;
}

textarea { height:100px; resize:none; }

.send {
  width:100%;
  margin-top:20px;
  padding:16px;
  font-size:18px;
  border-radius:14px;
  border:none;
  background:#007aff;
  color:#fff;
}

/* STEP 3 – SOURCES */
.sources {
  display:grid;
  grid-template-columns:repeat(2,160px);
  gap:20px;
  justify-content:center;
  margin-top:24px;
}

.source-card {
  height:90px;
  border-radius:22%;
  background:rgba(255,255,255,.9);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:15px;
  padding:12px;
  box-shadow:0 6px 16px rgba(0,0,0,.35);
  transition:.15s;
}

.source-card.selected {
  background:#007aff;
  color:#fff;
  transform:scale(.96);
}

/* ADMIN */
.admin-list {
  display:grid;
  grid-template-columns:repeat(2, minmax(220px, 1fr));
  gap:16px 32px;
  max-width:520px;
  margin:24px auto;
}

.admin-list label {
  display:flex;
  align-items:center;
  gap:12px;
  font-size:18px;
  color:#fff;
}

.admin-list input {
  width:20px;
  height:20px;
}
</style>
</head>

<body>

<!-- STEP 1 -->
<div id="step1" class="screen active">
  <h2>Кто из сотрудников Вам помогал?</h2>
  <div class="subtitle">Выберите из ниже перечисленного списка</div>
  <div class="employees" id="employees"></div>
  <button class="admin-btn" onclick="openAdmin()">⚙️ Смена</button>
</div>

<!-- STEP 2 -->
<div id="step2" class="screen">
  <button class="back-top" onclick="show('step1')">←</button>
  <h2>Оцените работу</h2>
  <div class="rating" id="rating"></div>
  <textarea id="comment" placeholder="Если хотите — напишите комментарий"></textarea>
  <button class="send" onclick="goStep3()">Далее</button>
</div>

<!-- STEP 3 -->
<div id="step3" class="screen">
  <button class="back-top" onclick="show('step2')">←</button>
  <h2>Откуда вы о нас узнали?</h2>

  <div class="sources">
    <div class="source-card" onclick="selectSource(this,'Социальные сети')">Социальные сети</div>
    <div class="source-card" onclick="selectSource(this,'Проходили мимо')">Проходили мимо</div>
    <div class="source-card" onclick="selectSource(this,'От друзей')">От друзей</div>
    <div class="source-card" onclick="selectSource(this,'Уже являюсь вашим клиентом')">
      Уже являюсь вашим клиентом
    </div>
  </div>

  <input id="phone" placeholder="Телефон для обратной связи (необязательно)">
  <button class="send" onclick="send()">Отправить</button>
</div>

<!-- THANKS -->
<div id="thanks" class="screen">
  <h2>Благодарим за визит</h2>
  <p style="text-align:center; color:rgba(255,255,255,0.85); margin-top:12px;">
    Ваше мнение очень важно для нас
  </p>
</div>

<!-- ADMIN -->
<div id="admin" class="screen">
  <button class="back-top" onclick="show('step1')">←</button>
  <h2>Кто сегодня в смене</h2>
  <div class="admin-list" id="adminList"></div>
  <button class="admin-btn" onclick="saveToday()">Сохранить</button>
</div>

<script>
const SCRIPT_URL = "ВСТАВЬ_URL_APPS_SCRIPT";

/* СОТРУДНИКИ */
const allEmployees = [
  { name:"Эфенди", photo:"efendi.jpg" },
  { name:"Иван", photo:"ivan.jpg" },
  { name:"Мария", photo:"masha.jpg" },
  { name:"Андрей", photo:"andrey.jpg" },
  { name:"Ярослав", photo:"yaroslav.jpg" },
  { name:"Владислав", photo:"vladislav.jpg" },
  { name:"Екатерина", photo:"ekaterina.jpg" },
  { name:"Тофик", photo:"tofik.jpg" },
  { name:"Артём", photo:"artem.jpg" },
  { name:"Михаил", photo:"misha.jpg" },
  { name:"Тамрико", photo:"tamriko.jpg" },
  { name:"Роза", photo:"roza.jpg" },
  { name:"Ильдар", photo:"ildar.jpg" }
];

let todayEmployees =
  JSON.parse(localStorage.getItem("todayEmployees")) || allEmployees;

let employee = null;
let score = 0;
let source = "";

/* НАВИГАЦИЯ */
function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* STEP 1 */
function renderEmployees() {
  const wrap = document.getElementById("employees");
  wrap.innerHTML = "";
  todayEmployees.forEach(e => {
    const el = document.createElement("div");
    el.className = "employee";
    el.innerHTML = `
      <div class="avatar"><img src="${e.photo}"></div>
      <div class="name">${e.name}</div>
    `;
    el.addEventListener("touchstart", () => selectEmployee(e), { passive:true });
    el.addEventListener("click", () => selectEmployee(e));
    wrap.appendChild(el);
  });
}

/* ADMIN */
function openAdmin() {
  show("admin");
  const list = document.getElementById("adminList");
  list.innerHTML = "";
  allEmployees.forEach(e => {
    const checked = todayEmployees.some(t => t.name === e.name);
    list.innerHTML += `
      <label>
        <input type="checkbox" ${checked ? "checked" : ""} value="${e.name}">
        ${e.name}
      </label>`;
  });
}

function saveToday() {
  const selected = [...document.querySelectorAll("#adminList input:checked")]
    .map(i => i.value);
  todayEmployees = allEmployees.filter(e => selected.includes(e.name));
  localStorage.setItem("todayEmployees", JSON.stringify(todayEmployees));
  show("step1");
  renderEmployees();
}

/* STEP 2 – iPad FIX */
function selectEmployee(e) {
  employee = e;
  renderRating();
  show("step2");
}

function renderRating() {
  const wrap = document.getElementById("rating");
  wrap.innerHTML = "";

  for (let i = 1; i <= 10; i++) {
    const item = document.createElement("div");
    item.className = "rating-item";
    item.innerHTML = `<img src="Peak${i}.jpg">`;

    const handler = (ev) => {
      ev.preventDefault();
      ev.stopPropagation();

      if (score === i) {
        score = 0;
        document.querySelectorAll(".rating-item")
          .forEach(el => el.classList.remove("selected"));
        return;
      }

      score = i;
      document.querySelectorAll(".rating-item")
        .forEach(el => el.classList.remove("selected"));
      item.classList.add("selected");
    };

    item.addEventListener("touchstart", handler, { passive:false });
    item.addEventListener("click", handler);

    wrap.appendChild(item);
  }
}

function goStep3() {
  if (!score) return;
  show("step3");
}

/* STEP 3 */
function selectSource(el, val) {
  document.querySelectorAll(".source-card")
    .forEach(c => c.classList.remove("selected"));
  el.classList.add("selected");
  source = val;
}

/* SEND */
function send() {
  fetch(SCRIPT_URL, {
    method:"POST",
    mode:"no-cors",
    body: JSON.stringify({
      employee: employee?.name || "",
      score,
      comment: comment.value,
      source,
      phone: phone.value
    })
  });

  show("thanks");
  setTimeout(() => location.reload(), 4000);
}

/* INIT */
renderEmployees();
</script>

</body>
</html>
